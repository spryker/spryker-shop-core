{% extends model('component') %}

{% define config = {
    name: 'product-item',
    tag: 'article',
} %}

{% define data = {
    product: required,
    name: data.product.name | default,
    sku: data.product.sku | default,
    url: data.product.url | default,
    image: data.product.images is defined ? data.product.images.0.externalUrlSmall | default,
    idProductAbstract: data.product.idProductAbstract | default,
    currencyIsoCode: null,
} %}

{%- block extraClass %} box{% endblock -%}

{% block body %}
    {% block thumbnailWrapper %}
        {% set extraClass = '' %}
        {% set modifiers = [] %}

        {% block imageContainer %}
            {% macro thumbnail(src, alt='', extraClass='', modifiers=[]) %}
                {% include atom('thumbnail') with {
                    class: extraClass,
                    modifiers: modifiers,
                    attributes: {
                        src: src,
                        alt: alt,
                    },
                } only %}
            {% endmacro %}

            {% block image %}
                {% if data.url %}
                    {% block imageLink %}
                        <a href="{{ path(data.url) }}">
                            {{ _self.thumbnail(data.image, data.name, extraClass, modifiers) }}
                        </a>
                    {% endblock %}
                {% endif %}
                {% if not data.url %}
                    {% block productThumbnail %}
                        {{ _self.thumbnail(data.image, data.name, extraClass, modifiers) }}
                    {% endblock %}
                {% endif %}
            {% endblock %}
        {% endblock %}
    {% endblock %}

    {% block labels %}
        {% if data.idProductAbstract %}
            {% block productAbstractLabels %}
                {% widget 'ProductAbstractLabelWidget' args [data.idProductAbstract] only %}{% endwidget %}
            {% endblock %}
        {% endif %}
    {% endblock %}

    {% block groups %}
        {% if data.idProductAbstract %}
            {% block productAbstractGroups %}
                {% widget 'ProductGroupWidget' args [data.idProductAbstract] only %}{% endwidget %}
            {% endblock %}
        {% endif %}
    {% endblock %}

    {% block content %}
        {% block name %}
            {% if data.name and data.url %}
                {% block link %}
                    <a class="{{ config.name }}__name" href="{{ path(data.url) }}">{{ data.name }}</a>
                {% endblock %}
            {% endif %}

            {% if data.name and not data.url %}
                {% block title %}
                    <span class="{{ config.name }}__name">{{ data.name }}</span>
                {% endblock %}
            {% endif %}
        {% endblock %}

        {% block sku %}
            {% if data.sku %}
                <div>{{ data.sku }}</div>
            {% endif %}
        {% endblock %}

        {% block rating %}
            {% if data.idProductAbstract %}
                {% block productAbstractRating %}
                    {% widget 'DisplayProductAbstractReviewWidget' args [data.idProductAbstract] only %}{% endwidget %}
                {% endblock %}
            {% endif %}
        {% endblock %}

        {% block priceContainer %}
            <div class="spacing-y">
                {% block price %}
                    {% if can('SeePricePermissionPlugin') %}
                        {% include molecule('money-price') with {
                            data: {
                                amount: data.product.prices.DEFAULT | default(null),
                                originalAmount: data.product.prices.ORIGINAL | default(null),
                                currencyIsoCode: data.currencyIsoCode,
                            },
                        } only %}
                    {% else %}
                        {{ 'customer.access.cannot_see_price' | trans }}
                    {% endif %}
                {% endblock %}
            </div>
        {% endblock %}
    {% endblock %}

    {% block actionsContainer %}
        <div class="{{ config.name }}__actions">
            {% block actions %}
                {% macro icon(modifiers, name) %}
                    {{- 'product.view' | trans -}}
                    {%- include atom('icon') with {
                        modifiers: modifiers,
                        data: {
                            name: name,
                        },
                    } only -%}
                {% endmacro %}

                {% if data.url %}
                    {% block action %}
                        <a class="button button--expand" href="{{ path(data.url) }}">
                            {{ _self.icon(['small'], 'angle-double-right') }}
                        </a>
                    {% endblock %}
                {% endif %}
            {% endblock %}
        </div>
    {% endblock %}
{% endblock %}
